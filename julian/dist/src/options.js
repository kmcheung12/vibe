(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const a=typeof browser<"u"?browser:chrome,l={llmConfig:{provider:"huggingface",model:"facebook/bart-large-cnn",apiKey:"",customUrl:""},providerApiKeys:{huggingface:"",custom:""},apiKeyUsage:{huggingface:{lastUsed:null},custom:{lastUsed:null}},promptRecipes:[{name:"Ask Julian",prompt:"Answer the following question: {text}"},{name:"Summarize Page",prompt:"Summarize the following text in a concise way: {text}"},{name:"Generate Text",prompt:"Generate text based on: {text}"}],generalSettings:{showSidebarToggle:!0,autoShowSidebar:!0}};let s={};function A(){s={status:document.getElementById("status"),currentProvider:document.getElementById("currentProvider"),currentApiKey:document.getElementById("currentApiKey"),currentModel:document.getElementById("currentModel"),llmProvider:document.getElementById("llmProvider"),model:document.getElementById("model"),modelContainer:document.getElementById("modelContainer"),customUrlContainer:document.getElementById("customUrlContainer"),customUrl:document.getElementById("customUrl"),apiKey:document.getElementById("apiKey"),testApi:document.getElementById("testApi"),recipes:document.getElementById("recipes"),addRecipe:document.getElementById("addRecipe"),showSidebarToggle:document.getElementById("showSidebarToggle"),autoShowSidebar:document.getElementById("autoShowSidebar"),save:document.getElementById("save"),reset:document.getElementById("reset"),apiKeysList:document.getElementById("apiKeysList"),newProviderName:document.getElementById("newProviderName"),newProviderKey:document.getElementById("newProviderKey"),addApiKey:document.getElementById("addApiKey")},h(),s.llmProvider.addEventListener("change",P),s.testApi.addEventListener("click",L),s.addRecipe.addEventListener("click",S),s.addApiKey.addEventListener("click",I),s.save.addEventListener("click",x),s.reset.addEventListener("click",T)}function h(){(typeof browser<"u"?a.storage.sync.get(["llmConfig","promptRecipes","generalSettings","providerApiKeys","apiKeyUsage"]):new Promise(o=>{a.storage.sync.get(["llmConfig","promptRecipes","generalSettings","providerApiKeys","apiKeyUsage"],o)})).then(o=>{const n={llmConfig:o.llmConfig||l.llmConfig,promptRecipes:o.promptRecipes||l.promptRecipes,generalSettings:o.generalSettings||l.generalSettings,providerApiKeys:o.providerApiKeys||l.providerApiKeys,apiKeyUsage:o.apiKeyUsage||l.apiKeyUsage};K(n.llmConfig),C(n),f(n.promptRecipes),g(n.providerApiKeys,n.apiKeyUsage)})}function K(e){s.currentProvider.textContent=e.provider==="custom"?"Custom":e.provider==="ollama"?"Ollama (Local)":"Hugging Face",s.currentApiKey.textContent=v(e.apiKey),e.provider==="custom"?s.currentModel.textContent=e.customUrl||"Not set":e.provider==="ollama"?s.currentModel.textContent=e.model||"llama2":s.currentModel.textContent=e.model||"facebook/bart-large-cnn"}function v(e){return e?e.length<=8?"********":`${e.slice(0,4)}${"*".repeat(e.length-8)}${e.slice(-4)}`:"Not set"}function C(e){const{llmConfig:o,generalSettings:n,providerApiKeys:t}=e;s.llmProvider.value=o.provider,s.model.value=o.model||"",s.customUrl.value=o.customUrl||"",o.provider==="huggingface"?s.apiKey.value=t.huggingface||o.apiKey||"":o.provider==="custom"?s.apiKey.value=t.custom||o.apiKey||"":s.apiKey.value="",s.showSidebarToggle.checked=n.showSidebarToggle,s.autoShowSidebar.checked=n.autoShowSidebar,P()}function P(){const e=s.llmProvider.value,o=e==="custom",n=e==="ollama";s.customUrlContainer.style.display=o?"block":"none",s.modelContainer.style.display=o?"none":"block",n?(s.apiKey.placeholder="Not required for Ollama",s.apiKey.disabled=!0):(s.apiKey.placeholder="Enter API Key",s.apiKey.disabled=!1),U(e)}function U(e){(typeof browser<"u"?a.storage.sync.get(["providerApiKeys"]):new Promise(n=>{a.storage.sync.get(["providerApiKeys"],n)})).then(n=>{const t=n.providerApiKeys||l.providerApiKeys;e==="huggingface"?s.apiKey.value=t.huggingface||"":e==="custom"?s.apiKey.value=t.custom||"":s.apiKey.value=""})}function f(e){s.recipes.innerHTML="",e.forEach((o,n)=>{const t=document.createElement("tr"),r=document.createElement("td"),i=document.createElement("input");i.type="text",i.value=o.name,i.className="recipe-name",i.dataset.index=n,r.appendChild(i);const c=document.createElement("td"),p=document.createElement("textarea");p.value=o.prompt,p.className="recipe-prompt",p.dataset.index=n,c.appendChild(p);const m=document.createElement("td"),u=document.createElement("button");u.textContent="Delete",u.onclick=()=>E(n),m.appendChild(u),t.appendChild(r),t.appendChild(c),t.appendChild(m),s.recipes.appendChild(t)})}function g(e,o){s.apiKeysList.innerHTML="";const n=Object.entries(e).map(([t,r])=>{var i;return{provider:t,key:r,lastUsed:((i=o[t])==null?void 0:i.lastUsed)||null}});if(Object.entries(o).forEach(([t,r])=>{!e.hasOwnProperty(t)&&t!=="huggingface"&&t!=="custom"&&n.push({provider:t,key:"",lastUsed:r.lastUsed||null})}),n.length===0||n.every(t=>t.provider==="ollama"||!t.key)){const t=document.createElement("tr"),r=document.createElement("td");r.colSpan=4,r.style.textAlign="center",r.style.padding="20px";const i=document.createElement("p");i.textContent="No API keys configured yet.",r.appendChild(i);const c=document.createElement("button");c.textContent="Add Your First API Key",c.onclick=()=>{document.querySelector("#newProviderName").scrollIntoView({behavior:"smooth"}),setTimeout(()=>document.querySelector("#newProviderName").focus(),500)},r.appendChild(c),t.appendChild(r),s.apiKeysList.appendChild(t);return}n.forEach(t=>{if(t.provider==="ollama"||!t.key)return;const r=document.createElement("tr"),i=document.createElement("td");i.textContent=y(t.provider);const c=document.createElement("td");c.textContent=v(t.key),c.className="masked-key";const p=document.createElement("td");p.textContent=b(t.lastUsed);const m=document.createElement("td"),u=document.createElement("button");u.textContent="Delete",u.onclick=()=>k(t.provider),m.appendChild(u),r.appendChild(i),r.appendChild(c),r.appendChild(p),r.appendChild(m),s.apiKeysList.appendChild(r)})}function y(e){return e==="huggingface"?"Hugging Face":e==="custom"?"Custom":e.split(/[_-]/).map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" ")}function b(e){return e?new Date(e).toLocaleString():"Never"}function S(){(typeof browser<"u"?a.storage.sync.get(["promptRecipes"]):new Promise(o=>{a.storage.sync.get(["promptRecipes"],o)})).then(o=>{const n=o.promptRecipes||l.promptRecipes;n.push({name:"New Recipe",prompt:"Enter your prompt here. Use {text} as placeholder."}),f(n)})}function E(e){(typeof browser<"u"?a.storage.sync.get(["promptRecipes"]):new Promise(n=>{a.storage.sync.get(["promptRecipes"],n)})).then(n=>{const t=n.promptRecipes||l.promptRecipes;e>=0&&e<t.length&&(t.splice(e,1),f(t))})}function I(){const e=s.newProviderName.value.trim(),o=s.newProviderKey.value.trim();if(!e){d("Please enter a provider name","error");return}if(!o){d("Please enter an API key","error");return}(typeof browser<"u"?a.storage.sync.get(["providerApiKeys","apiKeyUsage"]):new Promise(t=>{a.storage.sync.get(["providerApiKeys","apiKeyUsage"],t)})).then(t=>{const r=t.providerApiKeys||l.providerApiKeys,i=t.apiKeyUsage||l.apiKeyUsage,c=e.toLowerCase().replace(/\s+/g,"_");r[c]=o,i[c]||(i[c]={lastUsed:null}),(typeof browser<"u"?a.storage.sync.set({providerApiKeys:r,apiKeyUsage:i}):new Promise(m=>{a.storage.sync.set({providerApiKeys:r,apiKeyUsage:i},m)})).then(()=>{d(`API key for ${e} added successfully!`,"success"),s.newProviderName.value="",s.newProviderKey.value="",g(r,i)})})}function k(e){if(!confirm(`Are you sure you want to delete the API key for ${y(e)}?`))return;(typeof browser<"u"?a.storage.sync.get(["providerApiKeys","apiKeyUsage"]):new Promise(n=>{a.storage.sync.get(["providerApiKeys","apiKeyUsage"],n)})).then(n=>{const t=n.providerApiKeys||l.providerApiKeys,r=n.apiKeyUsage||l.apiKeyUsage;e==="huggingface"||e==="custom"?t[e]="":(delete t[e],delete r[e]),(typeof browser<"u"?a.storage.sync.set({providerApiKeys:t,apiKeyUsage:r}):new Promise(c=>{a.storage.sync.set({providerApiKeys:t,apiKeyUsage:r},c)})).then(()=>{d(`API key for ${y(e)} deleted successfully!`,"success"),g(t,r)})})}function L(){const e=w();if(!e.apiKey&&e.provider!=="ollama"){d("Please enter an API key","error");return}d("Testing API connection...","");const o="Hello, this is a test.";let n,t={"Content-Type":"application/json"},r;switch(e.provider){case"huggingface":n=`https://api-inference.huggingface.co/models/${e.model||"facebook/bart-large-cnn"}`,t.Authorization=`Bearer ${e.apiKey}`,r=JSON.stringify({inputs:o,options:{use_cache:!0,wait_for_model:!0}});break;case"ollama":n=e.customUrl||"http://localhost:11434/api/generate",r=JSON.stringify({model:e.model||"llama2",prompt:o,stream:!1});break;case"custom":if(!e.customUrl){d("Please enter a custom URL","error");return}n=e.customUrl,e.apiKey&&(t.Authorization=`Bearer ${e.apiKey}`),r=JSON.stringify({inputs:o});break;default:d("Unknown provider selected","error");return}fetch(n,{method:"POST",headers:t,body:r}).then(i=>{if(!i.ok)throw new Error(`API request failed with status ${i.status}`);return i.json()}).then(i=>{d("API connection successful!","success"),console.log("API response:",i),N(e.provider)}).catch(i=>{d(`API connection failed: ${i.message}`,"error"),console.error("API error:",i)})}function N(e){(typeof browser<"u"?a.storage.sync.get(["apiKeyUsage"]):new Promise(n=>{a.storage.sync.get(["apiKeyUsage"],n)})).then(n=>{const t=n.apiKeyUsage||l.apiKeyUsage;t[e]||(t[e]={}),t[e].lastUsed=new Date().toISOString(),a.storage.sync.set({apiKeyUsage:t})})}function w(){return{provider:s.llmProvider.value,model:s.model.value,apiKey:s.apiKey.value,customUrl:s.customUrl.value}}function B(){const e=[],o=document.querySelectorAll(".recipe-name"),n=document.querySelectorAll(".recipe-prompt");for(let t=0;t<o.length;t++)e.push({name:o[t].value,prompt:n[t].value});return e}function R(){return{showSidebarToggle:s.showSidebarToggle.checked,autoShowSidebar:s.autoShowSidebar.checked}}function x(){const e=w(),o=B(),n=R();(typeof browser<"u"?a.storage.sync.get(["providerApiKeys","apiKeyUsage"]):new Promise(r=>{a.storage.sync.get(["providerApiKeys","apiKeyUsage"],r)})).then(r=>{const i=r.providerApiKeys||l.providerApiKeys,c=r.apiKeyUsage||l.apiKeyUsage;e.provider==="huggingface"?i.huggingface=e.apiKey:e.provider==="custom"&&(i.custom=e.apiKey);const p={llmConfig:e,promptRecipes:o,generalSettings:n,providerApiKeys:i,apiKeyUsage:c};(typeof browser<"u"?a.storage.sync.set(p):new Promise(u=>{a.storage.sync.set(p,u)})).then(()=>{d("Settings saved successfully!","success"),K(e),g(i,c)})})}function T(){confirm("Are you sure you want to reset all settings to defaults?")&&(typeof browser<"u"?a.storage.sync.clear():new Promise(o=>{a.storage.sync.clear(o)})).then(()=>{d("Settings reset to defaults","success"),h()})}function d(e,o){s.status.textContent=e,s.status.className="status",o&&s.status.classList.add(o),s.status.style.display="block",setTimeout(()=>{s.status.style.display="none"},5e3)}document.addEventListener("DOMContentLoaded",A);
